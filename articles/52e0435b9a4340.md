---
title: "[boto3] NextTokenã‚’ä½¿ã£ã¦æƒ…å ±å–å¾—"
emoji: "ğŸ¤–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [python, boto3, nexttoken, aws]
published: true
publication_name: "iret"
---

## ã“ã®ãƒšãƒ¼ã‚¸ã«ã¤ã„ã¦
boto3ã§ `NextToken` ã‚’ä½¿ã†å ´é¢ãŒã‚ã£ãŸã®ã§ã€ `NextToken` ã¨ã¯ï¼Ÿã«ã¤ã„ã¦ç°¡å˜ã«ãƒ¡ãƒ¢ã—ã¾ã™ã€‚

### çµŒç·¯
ã“ã®Glueã‚¸ãƒ§ãƒ–å®Ÿè¡Œå±¥æ­´å–å¾—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¦ã„ã‚‹éš›ã«ã€ `NextToken` ã®ä½¿ã„æ–¹ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚

https://zenn.dev/isseeeeey55/articles/e46c0e4cbd89bd

boto3ã® `get_job_runs` ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã®ã‚¸ãƒ§ãƒ–å®Ÿè¡Œå±¥æ­´æ•°ã¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å–å¾—ã—ãŸã‚¸ãƒ§ãƒ–å®Ÿè¡Œå±¥æ­´æ•°ã«ä¹–é›¢ãŒã‚ã‚Šã¾ã—ãŸã€‚

ãã“ã§ç¢ºèªã—ãŸã¨ã“ã‚ã€æœ€å¤§ã§å–å¾—ã§ãã‚‹çµæœ( `MaxResults` )ãŒ200ä»¶ã¾ã§ã§ã€ãã‚Œä»¥ä¸Šå–å¾—ã—ãŸã„æ™‚ã« `NextToken` ã‚’ä½¿ã†å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚

ã¡ãªã¿ã«ã€boto3ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯è¨˜è¼‰ãŒãªãå®Ÿè¡Œçµæœã‹ã‚‰ç¢ºèªã—ã¦ã„ã¾ã™ã€‚
ã¾ãŸã€awscliã§ `GetJobRuns` ã‚’ä½¿ã†ã¨ã€ `MaxResults` ã¯1,000ä»¶ã§ã‚ã‚Šã€boto3ã¨ã¯é•ã„ã¾ã—ãŸã€‚

### å‚è€ƒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- boto3(get_job_runs)

https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/glue.html#Glue.Client.get_job_runs

- awscli(get_job_runs)

https://docs.aws.amazon.com/ja_jp/glue/latest/webapi/API_GetJobRuns.html

## NextTokenã¨ã¯
APIã«ã‚ˆã£ã¦æƒ…å ±å–å¾—ã‚’è¡Œã„ã€å–å¾—ä¸Šé™ã¾ã§é”ã—ãŸå ´åˆã«ã€`NextToken` ã«ãƒˆãƒ¼ã‚¯ãƒ³ãŒå…¥ã£ã¦ãã¾ã™ã€‚

```
"NextToken": "eyJOZXh0VGXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX="
```

ã“ã® `NextToken` ã‚’ä½¿ã†ã¨ã€ãã®ç¶šãã‹ã‚‰æƒ…å ±å–å¾—ã§ãã¾ã™ã€‚
ã‚ˆã£ã¦ã€ã“ã® `NextToken` ãŒãªããªã‚‹ã¾ã§ãƒ«ãƒ¼ãƒ—ã•ã›ã‚‹ã¨å…¨ä»¶å–å¾—ã§ãã‚‹ã€‚

### å„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®èª¬æ˜

- boto3ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
>NextToken (string) --
A continuation token, if not all requested job runs have been returned.

- AWSãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
>NextToken
A continuation token, if this is a continuation call.
Type: String
Required: No

## ã‚¹ã‚¯ãƒªãƒ—ãƒˆå´ã®ã‚µãƒ³ãƒ—ãƒ«
NextTokenã«ä½•ã‹å…¥ã£ã¦ã„ã‚‹å ´åˆã¯ã€ãã‚Œã‚’ä½¿ã£ã¦æƒ…å ±å–å¾—ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```
    if next_token is not None and next_token != '':
        response = session.client('glue').get_job_runs(
            JobName = job_name,
            MaxResults = 200,
            NextToken = next_token
        )
    else:
        response = session.client('glue').get_job_runs(
            JobName = job_name,
            MaxResults = 200
        )
```

## Lambdaã§ä½¿ç”¨ã™ã‚‹éš›ã®æ³¨æ„ç‚¹
ä»Šå›ã¯ä¸€æ™‚çš„ã«ä½¿ç”¨ã™ã‚‹ã ã‘ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã ã£ãŸã®ã§å•é¡Œã§ã¯ãªã‹ã£ãŸã§ã™ãŒã€Lambdaã§å®Ÿè¡Œã™ã‚‹å ´åˆã¯ä»¥ä¸‹ã®æ³¨æ„ç‚¹ã‚ã‚Šã€‚

- å®Ÿè¡Œæ™‚é–“ãŒå»¶ã³ã‚‹ã®ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã«æ³¨æ„ã€‚
    - ä»Šå›ã¯15åˆ†ã«è¨­å®šã€‚
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚‚å¤§ããå¢—ã‚„ã™å¿…è¦ãŒã‚ã‚‹ã®ã§æ³¨æ„ã€‚
    - ä»Šå›ã¯1024MBã«è¨­å®šã€‚
    - ä»¥ä¸‹ã®ã‚ˆã†ãªå®Ÿè¡Œã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã€ãƒ¡ãƒ¢ãƒªã‚µã‚¤ã‚ºã‚’èª¿æ•´ã—ã¦ã„ã¾ã™ã€‚

```
RequestId: 6df00cc9-1a0f-4ea5-bce5-38dc27788fa6 Error: Runtime exited with error: signal: killed
Runtime.ExitError
```

## å‚è€ƒè¨˜äº‹

https://zenn.dev/jun2021/articles/addad60175934d
https://qiita.com/Fujinamin_D/items/79cb42dff7f3467eee6a
